@using Newtonsoft.Json
@{
    ViewBag.Title = "Reportes | Clima Laboral";
    Layout = null;
}
<!DOCTYPE html>
<html lang="es-es" style="overflow-x:hidden;" ng-app="app">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="author" content="Grupo Autofin México" />
        <meta name="description" content="Reportes de la encuesta clima laboral" />
        <meta name="keywords" content="Grupo Autofin México, Reportes, Clima Laboral" />
        <title>@ViewBag.Title</title>
        @Styles.Render("~/bundles/cssAdmin")
        @Styles.Render("~/bundles/cssReporteoClima")
        <link href="~/css/reporteoClima.css" rel="stylesheet" />
        @{
            string NombreAdmin = Convert.ToString(Session["AdminLog"]);
            ViewBag.Perfil = Session["PerfilAdminLog"];
        }
        @Scripts.Render("~/bundles/jqueryAdmin")
        @Scripts.Render("~/bundles/jqueryReporteoClima")
        <script src="~/scripts/templates-functions.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqcloud/1.0.4/jqcloud.css" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.7.7/xlsx.core.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xls/0.7.4-a/xls.core.min.js"></script>
        <script src="~/scripts/ReporteoClima/html2canvas.js"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.3/jspdf.min.js"></script>
        @{
            if (true)
            {
                @*<script src="~/scripts/ReporteoClima/reporteoClima.min.js"></script>*@
                <script src="~/scripts/reporteoClimaLaboral_FromJob.js"></script>
            }
            else
            {
                <script src="~/scripts/reporteoClimaLaboral.js"></script>
            }
        }

        <script>
            localStorage["AdminLog"] = @Html.Raw(JsonConvert.SerializeObject(Session["AdminLog"]));
        </script>
        <style>
            .bodyVisible{
                opacity: 1;
            }
            .bodyInvisible{
                opacity: 1;
            }
            .screenshots{
                display: none;
            }
        </style>
        <script>
            var b64Document = "";
        </script>
    </head>
@{
    var usr = Convert.ToString(Session["AdminLog"]);
    if (!String.IsNullOrEmpty(usr))
    {
        <body @*ng-app="app"*@ ng-controller="reporteController as vm" ng-class="{ bodyVisible: !vm.isBusy, bodyInvisible: vm.isBusy }">
            <ul id="mySidenav" class="sidenav">
                <a href="javascript:void(0)" class="closebtn d-none" onclick="closeNav()"><i class="fas fa-arrow-left fa-lg color"></i></a>
                <span class="openbtn animated pulse slow" onclick="openNav()"><i class="fas fa-arrow-right fa-lg color"></i></span>
                <!--Seccion Permisos por usuario-->
                @{
                    //Validar permisos
                    var ActionEncuestasListar = false;
                    var ActionEncuestasCrear = false;
                    var ActionEncuestasOpc = false;

                    var ActionPlantillasListar = false;
                    var ActionPlantillasCrear = false;
                    var ActionPlantillasOpc = false;

                    var ActionReportesListar = false;
                    var ActionReportesCrear = false;
                    var ActionReportesOpc = false;

                    var ActionBDListar = false;
                    var ActionBDCrear = false;
                    var ActionBDOpc = false;

                    var ActionUsuariosListar = false;
                    var ActionUsuariosCrear = false;
                    var ActionUsuariosOpc = false;

                    var ActionEmpresasListar = false;

                    var ActionEmpresasCrear = false;
                    var chkEmpresasOpc = false;

                    var session = Session["AdminLog"];
                    var sessionPerfil = Session["PerfilAdminLog"];


                    ViewBag.Permisos = Session["Permisos"];
                    ViewBag.Modulos = Session["Modulos"];
                    //Model.ObjectsPermisos = new List<object>();
                    //Model.ObjectsPermisos = ViewBag.Permisos;

                    foreach (ML.PerfilModulo item in ViewBag.Permisos)
                    {
                        if (item.Modulo.Nombre == "Encuestas" && item.PerfilModuloAccion.Accion == "ListarEncuesta")
                        {
                            ActionEncuestasListar = true;
                        }
                        if (item.Modulo.Nombre == "Encuestas" && item.PerfilModuloAccion.Accion == "CrearEncuesta")
                        {
                            ActionEncuestasCrear = true;
                        }
                        if (item.Modulo.Nombre == "Encuestas" && item.PerfilModuloAccion.Accion == "OpcEncuesta")
                        {
                            ActionEncuestasOpc = true;
                        }
                        /**********************/
                        if (item.Modulo.Nombre == "Plantillas" && item.PerfilModuloAccion.Accion == "ListarPlantilla")
                        {
                            ActionPlantillasListar = true;
                        }
                        if (item.Modulo.Nombre == "Plantillas" && item.PerfilModuloAccion.Accion == "CrearPlantilla")
                        {
                            ActionPlantillasCrear = true;
                        }
                        if (item.Modulo.Nombre == "Plantillas" && item.PerfilModuloAccion.Accion == "OpcPlantilla")
                        {
                            ActionPlantillasOpc = true;
                        }
                        /***********************************/
                        if (item.Modulo.Nombre == "Reportes" && item.PerfilModuloAccion.Accion == "ListarReporte")
                        {
                            ActionReportesListar = true;
                        }
                        if (item.Modulo.Nombre == "Reportes" && item.PerfilModuloAccion.Accion == "CrearReporte")
                        {
                            ActionReportesCrear = true;
                        }
                        if (item.Modulo.Nombre == "Reportes" && item.PerfilModuloAccion.Accion == "OpcReporte")
                        {
                            ActionReportesOpc = true;
                        }
                        /***************************************/
                        if (item.Modulo.Nombre == "Base de datos" && item.PerfilModuloAccion.Accion == "ListarBD")
                        {
                            ActionBDListar = true;
                        }
                        if (item.Modulo.Nombre == "Base de datos" && item.PerfilModuloAccion.Accion == "CrearBD")
                        {
                            ActionBDCrear = true;
                        }
                        if (item.Modulo.Nombre == "Base de datos" && item.PerfilModuloAccion.Accion == "OpcBD")
                        {
                            ActionBDOpc = true;
                        }
                        /*******************************/
                        if (item.Modulo.Nombre == "Usuarios" && item.PerfilModuloAccion.Accion == "ListarUsuario")
                        {
                            ActionUsuariosListar = true;
                        }
                        if (item.Modulo.Nombre == "Usuarios" && item.PerfilModuloAccion.Accion == "CrearUsuario")
                        {
                            ActionUsuariosCrear = true;
                        }
                        if (item.Modulo.Nombre == "Usuarios" && item.PerfilModuloAccion.Accion == "OpcUsuario")
                        {
                            ActionUsuariosOpc = true;
                        }
                        /*********************************/
                        if (item.Modulo.Nombre == "Empresas" && item.PerfilModuloAccion.Accion == "ListarEmpresa")
                        {
                            ActionEmpresasListar = true;
                        }
                        if (item.Modulo.Nombre == "Empresas" && item.PerfilModuloAccion.Accion == "CrearEmpresa")
                        {
                            ActionEmpresasCrear = true;
                        }
                        if (item.Modulo.Nombre == "Empresas" && item.PerfilModuloAccion.Accion == "OpcEmpresa")
                        {
                            chkEmpresasOpc = true;
                        }
                    }

                    foreach (ML.PerfilModulo perf in ViewBag.Modulos)
                    {
                        ML.PerfilModulo perfilModulo = new ML.PerfilModulo();
                        perfilModulo.Modulo = new ML.Modulo();

                        perfilModulo.Modulo.Nombre = perf.Modulo.Nombre;



                        if (perfilModulo.Modulo.Nombre == "Encuestas")
                        {
                            <li id="Encuestas">
                                <div class="item-menu-icon" onclick="openNav()">
                                    <img src="~/img/icon-survey.png" alt="Icono Encuestas" class="img-white">
                                    <span class="tooltiptext">Encuestas</span>
                                </div>
                                <span class="item-menu d-none">
                                    <a data-toggle="collapse" href="#collapseSurvey" role="button" aria-expanded="false" aria-controls="collapseSurvey">
                                        <img src="~/img/icon-survey.png" class="img-white pr-3" alt="Icono Encuestas"> Encuestas
                                    </a>
                                </span>
                                <div class="collapse" id="collapseSurvey">
                                    <div class="card card-body py-2">
                                        <ul class="fa-ul pl-lg-4">
                                            @{
                                                if (ActionEncuestasCrear == true)
                                                {
                                                    <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("Create", "Encuesta")">Crear</a></li>
                                                }
                                                if (ActionEncuestasOpc == true)
                                                {
                                                    <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("Load", "Encuesta")">Importar encuesta</a></li>
                                                }
                                                if (ActionEncuestasListar == true)
                                                {
                                                    <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("GetAll", "Encuesta")">Listado</a></li>
                                                }
                                            }
                                        </ul>
                                    </div>
                                </div>
                            </li>
                                                }
                                                if (perfilModulo.Modulo.Nombre == "Plantillas")
                                                {
                                                    <li id="Plantillas">
                                                        <div class="item-menu-icon" onclick="openNav()">
                                                            <img src="~/img/icon-template.png" alt="Icono Plantillas" class="img-white">
                                                            <span class="tooltiptext">Plantillas</span>
                                                        </div>
                                                        <span class="item-menu d-none">
                                                            <a onclick="openNav()" data-toggle="collapse" href="#collapseTemplates" role="button" aria-expanded="false" aria-controls="collapseTemplates">
                                                                <img src="~/img/icon-template.png" class="img-white pr-3" alt="Icono Plantillas"> Plantillas
                                                            </a>
                                                        </span>
                                                        <div class="collapse" id="collapseTemplates">
                                                            <div class="card card-body py-2">
                                                                <ul class="fa-ul pl-lg-4">
                                                                    @{
                                                                        if (ActionPlantillasCrear == true)
                                                                        {
                                                                            <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("Create", "Plantillas")">Crear</a></li>
                                                                        }
                                                                        if (ActionPlantillasListar == true)
                                                                        {
                                                                            <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("Plantillas", "Plantillas")">Listado</a></li>
                                                                        }
                                                                        if (ActionPlantillasOpc == true)
                                                                        {
                                                                            <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="#">Más opciones</a></li>
                                                                        }
                                                                    }
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </li>
                                                                        }
                                                                        if (perfilModulo.Modulo.Nombre == "Reportes")
                                                                        {
                                                                            <li id="Reportes">
                                                                                <div class="item-menu-icon" onclick="openNav()">
                                                                                    <img src="~/img/icon-reports.png" alt="Icono Reportes" class="img-white">
                                                                                    <span class="tooltiptext">Reportes</span>
                                                                                </div>
                                                                                <span class="item-menu d-none">
                                                                                    <a onclick="openNav()" data-toggle="collapse" href="#collapseReports" role="button" aria-expanded="false" aria-controls="collapseReports">
                                                                                        <img src="~/img/icon-reports.png" class="img-white pr-3" alt="Icono Reportes"> Reportes
                                                                                    </a>
                                                                                </span>
                                                                                <div class="collapse" id="collapseReports">
                                                                                    <div class="card card-body py-2">
                                                                                        <ul class="fa-ul pl-lg-4">
                                                                                            @{
                                                                                                if (ActionReportesCrear == true)
                                                                                                {
                                                                                                    <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("Add", "ReporteD4U")">Crear</a></li>
                                                                                                }
                                                                                                if (ActionReportesListar == true)
                                                                                                {
                                                                                                    <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("GetAll", "Reporte")">Listado</a></li>
                                                                                                }
                                                                                                if (ActionReportesOpc == true)
                                                                                                {
                                                                                                    <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="#">Más opciones</a></li>
                                                                                                }
                                                                                            }
                                                                                        </ul>
                                                                                    </div>
                                                                                </div>
                                                                            </li>
                                                                                                }
                                                                                                if (perfilModulo.Modulo.Nombre == "Base de datos")
                                                                                                {
                                                                                                    <li id="BD">
                                                                                                        <div class="item-menu-icon" onclick="openNav()">
                                                                                                            <img src="~/img/icon-database.png" alt="Icono Bases de datos" class="img-white">
                                                                                                            <span class="tooltiptext">Bases de datos</span>
                                                                                                        </div>
                                                                                                        <span class="item-menu d-none">
                                                                                                            <a onclick="openNav()" data-toggle="collapse" href="#collapseDatabase" role="button" aria-expanded="false" aria-controls="collapseDatabase">
                                                                                                                <img src="~/img/icon-database.png" class="img-white pr-3" alt="Icono Bases de datos"> Bases de datos
                                                                                                            </a>
                                                                                                        </span>
                                                                                                        <div class="collapse" id="collapseDatabase">
                                                                                                            <div class="card card-body py-2">
                                                                                                                <ul class="fa-ul pl-lg-4">
                                                                                                                    @{
                                                                                                                        if (ActionBDCrear == true)
                                                                                                                        {
                                                                                                                            <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("Add", "BD")">Crear</a></li>
                                                                                                                        }
                                                                                                                        if (ActionBDListar == true)
                                                                                                                        {
                                                                                                                            <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("GetAllForListado", "BD")">Listado</a></li>
                                                                                                                        }
                                                                                                                        if (ActionBDOpc == true)
                                                                                                                        {
                                                                                                                            <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("GetEliminadas", "BD")">Administrar bases de datos eliminadas</a></li>
                                                                                                                        }
                                                                                                                    }
                                                                                                                </ul>
                                                                                                            </div>
                                                                                                        </div>
                                                                                                    </li>
                                                                                                                        }
                                                                                                                        if (perfilModulo.Modulo.Nombre == "Usuarios")
                                                                                                                        {
                                                                                                                            <li id="Usuarios">
                                                                                                                                <div class="item-menu-icon" onclick="openNav()">
                                                                                                                                    <img src="~/img/icon-users.png" alt="Icono Usuarios" class="img-white">
                                                                                                                                    <span class="tooltiptext">Usuarios</span>
                                                                                                                                </div>
                                                                                                                                <span class="item-menu d-none">
                                                                                                                                    <a onclick="openNav()" data-toggle="collapse" href="#collapseUsers" role="button" aria-expanded="false" aria-controls="collapseUsers">
                                                                                                                                        <img src="~/img/icon-users.png" class="img-white pr-3" alt="Icono Usuarios"> Usuarios
                                                                                                                                    </a>
                                                                                                                                </span>
                                                                                                                                <div class="collapse" id="collapseUsers">
                                                                                                                                    <div class="card card-body py-2">
                                                                                                                                        <ul class="fa-ul pl-lg-4">
                                                                                                                                            @{
                                                                                                                                                if (ActionUsuariosCrear == true)
                                                                                                                                                {
                                                                                                                                                    <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("Add", "Administrador")">Crear</a></li>
                                                                                                                                                }
                                                                                                                                                if (ActionUsuariosListar == true)
                                                                                                                                                {
                                                                                                                                                    <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("GetAll", "Administrador")">Listado</a></li>
                                                                                                                                                }
                                                                                                                                                if (ActionUsuariosOpc == true)
                                                                                                                                                {
                                                                                                                                                    <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("GetAllEliminados", "Administrador")">Administrar usuarios eliminadas</a></li>
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        </ul>
                                                                                                                                    </div>
                                                                                                                                </div>
                                                                                                                            </li>
                                                                                                                                                }
                                                                                                                                                if (perfilModulo.Modulo.Nombre == "Empresas")
                                                                                                                                                {
                                                                                                                                                    <li id="Empresas">
                                                                                                                                                        <div class="item-menu-icon" onclick="openNav()">
                                                                                                                                                            <img src="~/img/icon-enterprises.png" alt="Icono Empresas" class="img-white">
                                                                                                                                                            <span class="tooltiptext">Empresas</span>
                                                                                                                                                        </div>
                                                                                                                                                        <span class="item-menu d-none">
                                                                                                                                                            <a onclick="openNav()" data-toggle="collapse" href="#collapseEnterprises" role="button" aria-expanded="false" aria-controls="collapseEnterprises">
                                                                                                                                                                <img src="~/img/icon-enterprises.png" class="img-white pr-3" alt="Icono Empresas"> Empresas
                                                                                                                                                            </a>
                                                                                                                                                        </span>
                                                                                                                                                        <div class="collapse" id="collapseEnterprises">
                                                                                                                                                            <div class="card card-body py-2">
                                                                                                                                                                <ul class="fa-ul pl-lg-4">
                                                                                                                                                                    @{
                                                                                                                                                                        if (ActionEmpresasCrear == true)
                                                                                                                                                                        {
                                                                                                                                                                            <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("Add", "Empresa")">Crear</a></li>
                                                                                                                                                                        }
                                                                                                                                                                        if (ActionEmpresasListar == true)
                                                                                                                                                                        {
                                                                                                                                                                            <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("GetAll", "Empresa")">Listado</a></li>
                                                                                                                                                                        }
                                                                                                                                                                        if (chkEmpresasOpc == true)
                                                                                                                                                                        {
                                                                                                                                                                            <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("GetAllEliminadas", "Empresa")">Administrar empresas eliminadas</a></li>
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                </ul>
                                                                                                                                                            </div>
                                                                                                                                                        </div>
                                                                                                                                                    </li>
                                                                                                                                                                            }
                                                                                                                                                                        }
                }
                <!--Fin seccion permisos por usuario-->



            </ul>
            <div id="main" style="margin-left: 50px;">
                <main id="wrapper">
                    <div id="top-bar">
                        <div class="container-fluid px-lg-5">
                            <div class="row">

                                <div class="col-6 col-sm-4 col-md-5">
                                    <img src="@Session["logo"]" class="logo-header" alt="Logo" onclick="GetDashBoard()">
                                </div>

                                <div class="col-6 col-sm-8 col-md-7">
                                    <div class="user-info">
                                        <span class="color">Hola</span>, @NombreAdmin  @{ foreach (var item in ViewBag.Perfil)
                                            { <span class="position"> / @item  </span> } } <img src="~/img/icon-user-male.jpg" class="avatar-header" width="50" height="50" alt="Avatar">
                                    </div>
                                </div>
                            </div><!--.row-->
                        </div><!--.container-fluid-->
                    </div>
                    <header id="header">
                        <nav class="navbar py-0 px-lg-5">
                            <a class="navbar-brand title-section-top" href="#">Escritorio</a>
                        </nav>
                    </header>
                    <section id="page-title">
                        <div class="container-fluid px-lg-5">
                            <h1 class="title-page-title">Bienvenido <span>Selecciona cualquiera de las herramientas para que comiences:</span></h1>
                        </div><!--.container-fluid-->
                    </section>
                    <section @*ng-controller="reporteController as vm"*@ id="content" class="">
                        @RenderBody()

                        @*@Html.Partial("~/Views/ReporteoClima/EstructuraReporte/_GridFinalReporte.cshtml")*@
                        @Html.Partial("~/Views/ReporteoClima/Loading.cshtml")

                    </section>
                </main>
            </div>
            <footer id="footer">
                <div class="container-fluid px-lg-5">
                    <div class="row">
                        <div class="col-6">
                            <p class="copyrights"><span class="color">DIAGNOSTIC 4U</span> @DateTime.Now.Year</p>
                        </div>
                        <div class="col-6">
                            <p class="text-support"><i class="far fa-life-ring"></i> SOPORTE</p>
                        </div>
                    </div>
                </div>
            </footer>
            <div style="display: none" id="mergeS"></div>
        </body>
    }
    else
    {
        /* Pagina de error */
        <body>
            <main id="wrapper">
                <div id="top-bar">
                    <div class="container-fluid px-lg-5">
                        <div class="row">
                            <div class="col-4 col-sm-5 col-md-5">
                                <img src="~/img/logo.png" class="logo-header" alt="Logo" onclick="">
                            </div>
                            <div style="display: none">
                                @RenderBody()
                            </div>

                            <div class="col-8 col-sm-7 col-md-7">
                                <div class="user-info">
                                    <span class="color">Hola</span>
                                    <img src="~/img/icon-user-male.jpg" class="avatar-header" width="50" height="50" alt="Avatar">
                                </div><!--.user-info-->
                            </div>
                        </div><!--.row-->
                    </div><!--.container-fluid-->
                </div>
                <section id="content">
                    <div class="content-wrap">
                        <div class="container-fluid px-lg-5">
                            <div class="row">
                                <div class="col-lg-8">
                                    <div hidden class="col-md-6 col-sm-12 col-xs-6 col-6">
                                        <h2>Ooops ha ocurrido un error</h2>
                                    </div>
                                    <div class="col-md-6 col-sm-12 col-xs-6 col-6">
                                        <h2>Ooops ha ocurrido un error :(</h2>
                                        <p>Accede nuevamente</p>
                                        <p><a id="urlLogn" href="">Login de usuario</a></p>
                                    </div>
                                    <div class="col-md-6 col-sm-12 col-xs-6 col-6">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
            <footer id="footer" style="bottom: 0; position: fixed;">
                <div class="container-fluid px-lg-5">
                    <div class="row">
                        <div class="col-6">
                            <p class="copyrights"><span class="color">DIAGNOSTIC 4U</span> 2020</p>
                        </div>
                        <div class="col-6">
                            <p class="text-support"><i class="far fa-life-ring"></i> SOPORTE</p>
                        </div>
                    </div>
                </div>
            </footer>
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">
            <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
            <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
            <script>
                var redirect = "http://" + window.location.href.split('/')[2] + "/LoginAdmin/Login";
                try {
                    var elem = document.getElementById("urlLogn").href = redirect;
                } catch (e) {

                }
                swal("Tu sesión ha expirado, serás redireccionado al Login", "", "info").then(function () {
                    var elem = document.getElementById("urlLogn").click();
                });
            </script>
        </body>
    }
}
    
</html>