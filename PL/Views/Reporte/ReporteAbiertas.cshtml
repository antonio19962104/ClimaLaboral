@using Newtonsoft.Json
@model ML.Administrador
@{
    ViewBag.Title = "ReporteAbiertas";
    Layout = "";
}
@{
    System.Web.Script.Serialization.JavaScriptSerializer serializer = new System.Web.Script.Serialization.JavaScriptSerializer();
    serializer.MaxJsonLength = Int32.MaxValue;
}

<!DOCTYPE html>
<html lang="es-es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>@ViewBag.Title</title>
    @Styles.Render("~/bundles/cssAdmin")
    @{
        //Session["PerfilAdminLog"]
        ViewBag.Perfil = Session["PerfilAdminLog"];
    }
    @Scripts.Render("~/bundles/jqueryAdmin")
    <script src="~/scripts/jquery-3.4.1.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <link href="https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css" rel="stylesheet" />
    <script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.4.0/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.4.0/js/buttons.flash.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.4.0/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.4.0/js/buttons.print.min.js"></script>
    <link href="https://cdn.datatables.net/buttons/1.4.0/css/buttons.dataTables.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdn.rawgit.com/bpampuch/pdfmake/0.1.27/build/pdfmake.min.js"></script>
    <script src="https://cdn.rawgit.com/bpampuch/pdfmake/0.1.27/build/vfs_fonts.js"></script>
    <script>
        $(document).ready(function () {
            $('#myTable').DataTable({
                dom: 'Bfrtip',
                buttons: [
                    'copy', 'csv', 'excel'
                ]
            });
            document.getElementById("loading").style.display = "none";
        });
    </script>
    <script src="https://smtpjs.com/v3/smtp.js"></script>
    <script>
    $(document).ready(function () {
        $.ajax({
            url: "/BD/GetAllForListadoJSON",
            type: "GET",
            success: function (response) {
                $("#DDLBD").empty();
                $("#DDLBD").append("<option value='"+ 0 +"'>-Selecciona-</option>");
                [].forEach.call(response.ListadoDeBaseDeDatos, function (elem){
                    if (elem.TipoBD.IdTipoBD == 1)
                        $("#DDLBD").append("<option value='"+ elem.IdBaseDeDatos +"'>" + elem.Nombre + "</option>");
                });
                $.ajax({
                    url: "/Reporte/GetUnidadNeg",
                    type: "GET",
                    success: function (response) {
                        $("#DDLUnidad").empty();
                        $("#DDLUnidad").append("<option value='"+ 0 +"'>-Selecciona-</option>");
                        [].forEach.call(response.Objects, function (elem){
                            $("#DDLUnidad").append("<option value='"+ elem.Descripcion +"'>" + elem.Descripcion + "</option>");
                        });
                        document.getElementsByClassName("busy")[0].style.display = "none";
                    }
                });
            }
        });
    });
    function getDataReporte(){
        if (document.getElementById("DDLUnidad").value == 0 || document.getElementById("DDLBD").value == 0){
            swal("Debe elegir una unidad de negocio y una base de datos para continuar", "", "info").then(function () {
                return false;
            });
        }
        else{
            $('#myTable').DataTable().destroy();
            $('tbody tr').remove();
            document.getElementById("loading").style.display = "block";
            let model = { descripcion: $("#DDLUnidad option:selected" ).text() }
            $.ajax({
                url: '/Reporte/GetEstructuraForAbiertas/?idBD=' + document.getElementById("DDLBD").value,
                type: 'POST',
                data: model,
                dataType: 'json',
                success: function (Response) {
                    if (Response.Data.length != 0) {
                        console.log(Response);
                        for (i = 0; i < Response.Data.length; i++) {
                            $('#mergeResult').append
                                ('<tr class="text-center" scope="col" value="" style=""><td><strong>' + Response.Data[i].Demografico + '</strong></td><td>' + Response.Data[i].Abierta1 + '</td><td>' + Response.Data[i].Abierta2 + '</td><td>' + Response.Data[i].Abierta3 + '</td><td>' + Response.Data[i].Abierta4 + '</td><td>' + Response.Data[i].Abierta5 + '</td><td>' + Response.Data[i].Abierta6 + '</td><td>' + Response.Data[i].Abierta7 + '</td></tr>');
                        }
                        $('#myTable').DataTable({
                            dom: 'Bfrtip',
                            buttons: [
                                'copy', 'csv', 'excel'
                            ]
                        });
                        document.getElementById("loading").style.display = "none";
                    }
                    else {
                        document.getElementById("loading").style.display = "none";
                        swal('No se encontraron registros', '', 'warning');
                    }
                },
                complete: function (Res) {
                    console.log(Res);
                }
            });
        }
    }

    function sendEmail(file) {
        Email.send({
            Host: "smtp.office365.com",
            Username: "jamurillo@grupoautofin.com",
            Password: "Pass@word02",
            To: 'j.antoniomg96@outlook.com',
            From: "jamurillo@grupoautofin.com",
            Subject: "Liga reporte",
            Body: "Hola te envío la liga del reporte: <a href='window.location.href = "+file+"' onclick='"+file+"'>Descarga el reporte</a>",
        }).then(
            swal('Email enviado', '', 'success')
        );
    }
    function tabletoExcel(table, name) {
        var uri = 'data:application/vnd.ms-excel;base64,'
              , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'
              , base64 = function (s) { return window.btoa(unescape(encodeURIComponent(s))); }
              , format = function (s, c) { return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; }); };
        if (!table.nodeType) table = document.getElementById(table);
        var ctx = { worksheet: name || 'Worksheet', table: table.innerHTML };
        //window.location.href = uri + base64(format(template, ctx));
        var file = uri + base64(format(template, ctx));
        return file;
    }
    function exportTableToExcel(tableID, filename){
        var downloadLink;
        var dataType = 'application/vnd.ms-excel';
        var tableSelect = document.getElementById(tableID);
        var tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');

        // Specify file name
        filename = filename?filename+'.xls':'excel_data.xls';

        // Create download link element
        downloadLink = document.createElement("a");

        document.body.appendChild(downloadLink);

        if(navigator.msSaveOrOpenBlob){
            var blob = new Blob(['ufeff', tableHTML], {
                type: dataType
            });
            navigator.msSaveOrOpenBlob( blob, filename);
        }else{
            // Create a link to the file
            downloadLink.href = 'data:' + dataType + ', ' + tableHTML;

            // Setting the file name
            downloadLink.download = filename;

            //triggering the function
            //downloadLink.click();
            return downloadLink;
        }
        return downloadLink;
    }
    </script>
    <script type="text/javascript">
    var tableToExcel = (function () {
        var uri = 'data:application/vnd.ms-excel;base64,'
          , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--><meta http-equiv="content-type" content="text/plain; charset=UTF-8"/></head><body><table>{table}</table></body></html>'
          , base64 = function (s) { return window.btoa(unescape(encodeURIComponent(s))) }
          , format = function (s, c) { return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; }) }
        return function (table, name) {
            if (!table.nodeType) table = document.getElementById(table)
            var ctx = { worksheet: name || 'Worksheet', table: table.innerHTML }
            window.location.href = uri + base64(format(template, ctx))
        }
    })()
    </script>
    <script>
            var usr = @Html.Raw(JsonConvert.SerializeObject(Session["AdminLog"]));
    </script>
</head>

@{
    var usr = Convert.ToString(Session["AdminLog"]);
    if (!String.IsNullOrEmpty(usr))
    {
        /* Cargar sitio */
        <body>
            <ul id="mySidenav" class="sidenav">
                <a href="javascript:void(0)" class="closebtn d-none" onclick="closeNav()"><i class="fas fa-arrow-left fa-lg color"></i></a>
                <span class="openbtn animated pulse slow" onclick="openNav()"><i class="fas fa-arrow-right fa-lg color"></i></span>


                <!--Seccion Permisos por usuario-->
                @{
                    //Validar permisos
                    var ActionEncuestasListar = false;
                    var ActionEncuestasCrear = false;
                    var ActionEncuestasOpc = false;

                    var ActionPlantillasListar = false;
                    var ActionPlantillasCrear = false;
                    var ActionPlantillasOpc = false;

                    var ActionReportesListar = false;
                    var ActionReportesCrear = false;
                    var ActionReportesOpc = false;

                    var ActionBDListar = false;
                    var ActionBDCrear = false;
                    var ActionBDOpc = false;

                    var ActionUsuariosListar = false;
                    var ActionUsuariosCrear = false;
                    var ActionUsuariosOpc = false;

                    var ActionEmpresasListar = false;

                    var ActionEmpresasCrear = false;
                    var chkEmpresasOpc = false;

                    var session = Session["AdminLog"];
                    var sessionPerfil = Session["PerfilAdminLog"];


                    ViewBag.Permisos = Session["Permisos"];
                    ViewBag.Modulos = Session["Modulos"];
                    //Model.ObjectsPermisos = new List<object>();
                    //Model.ObjectsPermisos = ViewBag.Permisos;

                    foreach (ML.PerfilModulo item in ViewBag.Permisos)
                    {
                        if (item.Modulo.Nombre == "Encuestas" && item.PerfilModuloAccion.Accion == "ListarEncuesta")
                        {
                            ActionEncuestasListar = true;
                        }
                        if (item.Modulo.Nombre == "Encuestas" && item.PerfilModuloAccion.Accion == "CrearEncuesta")
                        {
                            ActionEncuestasCrear = true;
                        }
                        if (item.Modulo.Nombre == "Encuestas" && item.PerfilModuloAccion.Accion == "OpcEncuesta")
                        {
                            ActionEncuestasOpc = true;
                        }
                        /**********************/
                        if (item.Modulo.Nombre == "Plantillas" && item.PerfilModuloAccion.Accion == "ListarPlantilla")
                        {
                            ActionPlantillasListar = true;
                        }
                        if (item.Modulo.Nombre == "Plantillas" && item.PerfilModuloAccion.Accion == "CrearPlantilla")
                        {
                            ActionPlantillasCrear = true;
                        }
                        if (item.Modulo.Nombre == "Plantillas" && item.PerfilModuloAccion.Accion == "OpcPlantilla")
                        {
                            ActionPlantillasOpc = true;
                        }
                        /***********************************/
                        if (item.Modulo.Nombre == "Reportes" && item.PerfilModuloAccion.Accion == "ListarReporte")
                        {
                            ActionReportesListar = true;
                        }
                        if (item.Modulo.Nombre == "Reportes" && item.PerfilModuloAccion.Accion == "CrearReporte")
                        {
                            ActionReportesCrear = true;
                        }
                        if (item.Modulo.Nombre == "Reportes" && item.PerfilModuloAccion.Accion == "OpcReporte")
                        {
                            ActionReportesOpc = true;
                        }
                        /***************************************/
                        if (item.Modulo.Nombre == "Base de datos" && item.PerfilModuloAccion.Accion == "ListarBD")
                        {
                            ActionBDListar = true;
                        }
                        if (item.Modulo.Nombre == "Base de datos" && item.PerfilModuloAccion.Accion == "CrearBD")
                        {
                            ActionBDCrear = true;
                        }
                        if (item.Modulo.Nombre == "Base de datos" && item.PerfilModuloAccion.Accion == "OpcBD")
                        {
                            ActionBDOpc = true;
                        }
                        /*******************************/
                        if (item.Modulo.Nombre == "Usuarios" && item.PerfilModuloAccion.Accion == "ListarUsuario")
                        {
                            ActionUsuariosListar = true;
                        }
                        if (item.Modulo.Nombre == "Usuarios" && item.PerfilModuloAccion.Accion == "CrearUsuario")
                        {
                            ActionUsuariosCrear = true;
                        }
                        if (item.Modulo.Nombre == "Usuarios" && item.PerfilModuloAccion.Accion == "OpcUsuario")
                        {
                            ActionUsuariosOpc = true;
                        }
                        /*********************************/
                        if (item.Modulo.Nombre == "Empresas" && item.PerfilModuloAccion.Accion == "ListarEmpresa")
                        {
                            ActionEmpresasListar = true;
                        }
                        if (item.Modulo.Nombre == "Empresas" && item.PerfilModuloAccion.Accion == "CrearEmpresa")
                        {
                            ActionEmpresasCrear = true;
                        }
                        if (item.Modulo.Nombre == "Empresas" && item.PerfilModuloAccion.Accion == "OpcEmpresa")
                        {
                            chkEmpresasOpc = true;
                        }
                    }

                    foreach (ML.PerfilModulo perf in ViewBag.Modulos)
                    {
                        ML.PerfilModulo perfilModulo = new ML.PerfilModulo();
                        perfilModulo.Modulo = new ML.Modulo();

                        perfilModulo.Modulo.Nombre = perf.Modulo.Nombre;



                        if (perfilModulo.Modulo.Nombre == "Encuestas")
                        {
                            <li id="Encuestas">
                                <div class="item-menu-icon" onclick="openNav()">
                                    <img src="~/img/icon-survey.png" alt="Icono Encuestas" class="img-white">
                                    <span class="tooltiptext">Encuestas</span>
                                </div>
                                <span class="item-menu d-none">
                                    <a data-toggle="collapse" href="#collapseSurvey" role="button" aria-expanded="false" aria-controls="collapseSurvey">
                                        <img src="~/img/icon-survey.png" class="img-white pr-3" alt="Icono Encuestas"> Encuestas
                                    </a>
                                </span>
                                <div class="collapse" id="collapseSurvey">
                                    <div class="card card-body py-2">
                                        <ul class="fa-ul pl-lg-4">
                                            @{
                                                if (ActionEncuestasCrear == true)
                                                {
                                                    <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("Create", "Encuesta")">Crear</a></li>
                                                }
                                                if (ActionEncuestasOpc == true)
                                                {
                                                    <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("Load", "Encuesta")">Importar encuesta</a></li>
                                                }
                                                if (ActionEncuestasListar == true)
                                                {
                                                    <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("GetAll", "Encuesta")">Listado</a></li>
                                                }
                                            }
                                        </ul>
                                    </div>
                                </div>
                            </li>
                                                }
                                                if (perfilModulo.Modulo.Nombre == "Plantillas")
                                                {
                                                    <li id="Plantillas">
                                                        <div class="item-menu-icon" onclick="openNav()">
                                                            <img src="~/img/icon-template.png" alt="Icono Plantillas" class="img-white">
                                                            <span class="tooltiptext">Plantillas</span>
                                                        </div>
                                                        <span class="item-menu d-none">
                                                            <a onclick="openNav()" data-toggle="collapse" href="#collapseTemplates" role="button" aria-expanded="false" aria-controls="collapseTemplates">
                                                                <img src="~/img/icon-template.png" class="img-white pr-3" alt="Icono Plantillas"> Plantillas
                                                            </a>
                                                        </span>
                                                        <div class="collapse" id="collapseTemplates">
                                                            <div class="card card-body py-2">
                                                                <ul class="fa-ul pl-lg-4">
                                                                    @{
                                                                        if (ActionPlantillasCrear == true)
                                                                        {
                                                                            <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("Create", "Plantillas")">Crear</a></li>
                                                                        }
                                                                        if (ActionPlantillasListar == true)
                                                                        {
                                                                            <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("Plantillas", "Plantillas")">Listado</a></li>
                                                                        }
                                                                        if (ActionPlantillasOpc == true)
                                                                        {
                                                                            <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="#">Más opciones</a></li>
                                                                        }
                                                                    }
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </li>
                                                                        }
                                                                        if (perfilModulo.Modulo.Nombre == "Reportes")
                                                                        {
                                                                            <li id="Reportes">
                                                                                <div class="item-menu-icon" onclick="openNav()">
                                                                                    <img src="~/img/icon-reports.png" alt="Icono Reportes" class="img-white">
                                                                                    <span class="tooltiptext">Reportes</span>
                                                                                </div>
                                                                                <span class="item-menu d-none">
                                                                                    <a onclick="openNav()" data-toggle="collapse" href="#collapseReports" role="button" aria-expanded="false" aria-controls="collapseReports">
                                                                                        <img src="~/img/icon-reports.png" class="img-white pr-3" alt="Icono Reportes"> Reportes
                                                                                    </a>
                                                                                </span>
                                                                                <div class="collapse" id="collapseReports">
                                                                                    <div class="card card-body py-2">
                                                                                        <ul class="fa-ul pl-lg-4">
                                                                                            @{
                                                                                                if (ActionReportesCrear == true)
                                                                                                {
                                                                                                    <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("Add", "ReporteD4U")">Crear</a></li>
                                                                                                }
                                                                                                if (ActionReportesListar == true)
                                                                                                {
                                                                                                    <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("GetAll", "Reporte")">Listado</a></li>
                                                                                                }
                                                                                                if (ActionReportesOpc == true)
                                                                                                {
                                                                                                    <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="#">Más opciones</a></li>
                                                                                                }
                                                                                            }
                                                                                        </ul>
                                                                                    </div>
                                                                                </div>
                                                                            </li>
                                                                                                }
                                                                                                if (perfilModulo.Modulo.Nombre == "Base de datos")
                                                                                                {
                                                                                                    <li id="BD">
                                                                                                        <div class="item-menu-icon" onclick="openNav()">
                                                                                                            <img src="~/img/icon-database.png" alt="Icono Bases de datos" class="img-white">
                                                                                                            <span class="tooltiptext">Bases de datos</span>
                                                                                                        </div>
                                                                                                        <span class="item-menu d-none">
                                                                                                            <a onclick="openNav()" data-toggle="collapse" href="#collapseDatabase" role="button" aria-expanded="false" aria-controls="collapseDatabase">
                                                                                                                <img src="~/img/icon-database.png" class="img-white pr-3" alt="Icono Bases de datos"> Bases de datos
                                                                                                            </a>
                                                                                                        </span>
                                                                                                        <div class="collapse" id="collapseDatabase">
                                                                                                            <div class="card card-body py-2">
                                                                                                                <ul class="fa-ul pl-lg-4">
                                                                                                                    @{
                                                                                                                        if (ActionBDCrear == true)
                                                                                                                        {
                                                                                                                            <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("Add", "BD")">Crear</a></li>
                                                                                                                        }
                                                                                                                        if (ActionBDListar == true)
                                                                                                                        {
                                                                                                                            <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("GetAllForListado", "BD")">Listado</a></li>
                                                                                                                        }
                                                                                                                        if (ActionBDOpc == true)
                                                                                                                        {
                                                                                                                            <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("GetEliminadas", "BD")">Administrar bases de datos eliminadas</a></li>
                                                                                                                        }
                                                                                                                    }
                                                                                                                </ul>
                                                                                                            </div>
                                                                                                        </div>
                                                                                                    </li>
                                                                                                                        }
                                                                                                                        if (perfilModulo.Modulo.Nombre == "Usuarios")
                                                                                                                        {
                                                                                                                            <li id="Usuarios">
                                                                                                                                <div class="item-menu-icon" onclick="openNav()">
                                                                                                                                    <img src="~/img/icon-users.png" alt="Icono Usuarios" class="img-white">
                                                                                                                                    <span class="tooltiptext">Usuarios</span>
                                                                                                                                </div>
                                                                                                                                <span class="item-menu d-none">
                                                                                                                                    <a onclick="openNav()" data-toggle="collapse" href="#collapseUsers" role="button" aria-expanded="false" aria-controls="collapseUsers">
                                                                                                                                        <img src="~/img/icon-users.png" class="img-white pr-3" alt="Icono Usuarios"> Usuarios
                                                                                                                                    </a>
                                                                                                                                </span>
                                                                                                                                <div class="collapse" id="collapseUsers">
                                                                                                                                    <div class="card card-body py-2">
                                                                                                                                        <ul class="fa-ul pl-lg-4">
                                                                                                                                            @{
                                                                                                                                                if (ActionUsuariosCrear == true)
                                                                                                                                                {
                                                                                                                                                    <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("Add", "Administrador")">Crear</a></li>
                                                                                                                                                }
                                                                                                                                                if (ActionUsuariosListar == true)
                                                                                                                                                {
                                                                                                                                                    <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("GetAll", "Administrador")">Listado</a></li>
                                                                                                                                                }
                                                                                                                                                if (ActionUsuariosOpc == true)
                                                                                                                                                {
                                                                                                                                                    <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("GetAllEliminados", "Administrador")">Administrar usuarios eliminadas</a></li>
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        </ul>
                                                                                                                                    </div>
                                                                                                                                </div>
                                                                                                                            </li>
                                                                                                                                                }
                                                                                                                                                if (perfilModulo.Modulo.Nombre == "Empresas")
                                                                                                                                                {
                                                                                                                                                    <li id="Empresas">
                                                                                                                                                        <div class="item-menu-icon" onclick="openNav()">
                                                                                                                                                            <img src="~/img/icon-enterprises.png" alt="Icono Empresas" class="img-white">
                                                                                                                                                            <span class="tooltiptext">Empresas</span>
                                                                                                                                                        </div>
                                                                                                                                                        <span class="item-menu d-none">
                                                                                                                                                            <a onclick="openNav()" data-toggle="collapse" href="#collapseEnterprises" role="button" aria-expanded="false" aria-controls="collapseEnterprises">
                                                                                                                                                                <img src="~/img/icon-enterprises.png" class="img-white pr-3" alt="Icono Empresas"> Empresas
                                                                                                                                                            </a>
                                                                                                                                                        </span>
                                                                                                                                                        <div class="collapse" id="collapseEnterprises">
                                                                                                                                                            <div class="card card-body py-2">
                                                                                                                                                                <ul class="fa-ul pl-lg-4">
                                                                                                                                                                    @{
                                                                                                                                                                        if (ActionEmpresasCrear == true)
                                                                                                                                                                        {
                                                                                                                                                                            <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("Add", "Empresa")">Crear</a></li>
                                                                                                                                                                        }
                                                                                                                                                                        if (ActionEmpresasListar == true)
                                                                                                                                                                        {
                                                                                                                                                                            <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("GetAll", "Empresa")">Listado</a></li>
                                                                                                                                                                        }
                                                                                                                                                                        if (chkEmpresasOpc == true)
                                                                                                                                                                        {
                                                                                                                                                                            <li><span class="fa-li"><i class="fas fa-minus"></i></span> <a href="@Url.Action("GetAllEliminadas", "Empresa")">Administrar empresas eliminadas</a></li>
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                </ul>
                                                                                                                                                            </div>
                                                                                                                                                        </div>
                                                                                                                                                    </li>
                                                                                                                                                                            }
                                                                                                                                                                        }
                }
                <!--Fin seccion permisos por usuario-->



            </ul>
            <div id="loading" class="busy">
            </div>
            <style>
                .busy {
                    /*background: url(../../img/ReporteoClima/loading.gif) no-repeat center center;*/
                    background: url(../../images/loadimage.gif) no-repeat center center; /*loadimage.gif*/
                    width: 100%;
                    height: 100%;
                    background-color: #000;
                    opacity: 0.9;
                    position: fixed;
                    left: 0;
                    top: 0;
                    z-index: 2147483601;
                }
            </style>

            <div id="main" style="margin-left: 50px;">
                <main id="wrapper" class="animate fadeIn">
                    <div id="top-bar">
                        <div class="container-fluid px-lg-5">
                            <div class="row center-vertically">

                                <div class="col-6 col-sm-4 col-md-5">
                                    <img src="@Session["logo"]" class="logo-header" alt="Logo" onclick="GetDashBoard()">
                                </div>

                                <div class="col-6 col-sm-8 col-md-7">
                                    <div class="user-info">
                                        <span class="color">Hola</span>, @Session["AdminLog"]  @{ foreach (var item in ViewBag.Perfil)
                                            { <span class="position"> / @item  </span> } } <img src="~/img/icon-user-male.jpg" class="avatar-header" width="50" height="50" alt="Avatar">
                                    </div><!--.user-info-->
                                </div>
                            </div><!--.row-->
                        </div><!--.container-fluid-->
                    </div>


                    <section id="page-title">
                        <div class="container-fluid px-lg-5">
                            <img src="~/img/icon-reports.png" class="img-fluid">
                            <h1 class="title-page-survey">
                                Reporte / <span>Reporte de respuestas abiertas</span>
                            </h1>
                        </div><!--.container-fluid-->
                    </section>

                    <section id="content">

                        <div class="container-fluid px-lg-5">
                            <div class="row">
                                <div class="col-lg-12">
                                    @*<div class="col-lg-12 col-md-12 col-xs-12 col-sm-12">*@
                                    <div class="col-lg-5 col-md-5 col-xs-5 col-sm-5" style="margin-bottom:20px; margin-top:30px;">
                                        <p style="">Unidad de negocio</p>
                                        <select id="DDLUnidad" name="DDLCompanyCategoria" class="form-control"></select>
                                        <br />
                                        <p style="">Base de datos</p>
                                        <select id="DDLBD" name="DDLCompanyCategoria" class="form-control"></select>
                                        <input style="margin-top:10px;" type="submit" value="Ver reporte" class="btn btn-danger" onclick="getDataReporte()" />
                                    </div>
                                    <div class="col-12">
                                        <table id="myTable" class="table table-responsive-sm table-bordered" border="1" style="width: 100%;">
                                            <thead style="font-weight:bold">
                                                <tr>
                                                    <td id="">DEMOGRAFICO</td>
                                                    <td>EXISTE ALGO ESPECIAL EN LA EMPRESA</td>
                                                    <td>SI PUDIERA HACER ALGUN CAMBIO</td>
                                                    <td>FORTALEZAS JEFE DIRECTO</td>
                                                    <td>AREAS DE OPORTUNIDAD JEFE DIRECTO</td>
                                                    <td>QUE ME MOTIVA A tdABAJAR EN LA EMPRESA</td>
                                                    <td>QUE ME HARIA DEJAR LA EMPRESA</td>
                                                    <td>RECIBI PRESION</td>
                                                </tr>
                                            </thead>
                                            <tbody id="mergeResult"></tbody>
                                        </table>
                                    </div>
                                    @*<p>Es master</p>
                                        @Html.EditorFor(model => model.IsMaster, new { @class = "radio", @type = "radio", @value = "false" })*@
                                    @*</div>*@
                                </div>
                            </div>
                        </div>

                    </section>


                </main><!--#wrapper-->
            </div>
            <footer id="footer">
                <div class="container-fluid px-lg-5">
                    <div class="row">
                        <div class="col-6">
                            <p class="copyrights"><span class="color">DIAGNOSTIC 4U</span> 2020</p>
                        </div>
                        <div class="col-6">
                            <p class="text-support"><i class="far fa-life-ring"></i> SOPORTE</p>
                        </div>
                    </div>
                </div>
            </footer>
            <script>
        function GetDashBoard() {
            window.location.href = "/DashBoard/DashBoard"
        }
            </script>
        </body>
    }
    else
    {
        /* Pagina de error */
        <body>
            <main id="wrapper">
                <div id="top-bar">
                    <div class="container-fluid px-lg-5">
                        <div class="row">
                            <div class="col-4 col-sm-5 col-md-5">
                                <img src="~/img/logo.png" class="logo-header" alt="Logo" onclick="">
                            </div>
                            <div style="display: none">
                                @*@RenderSection("H1", false)
                                @RenderSection("Header", false)*@
                            </div>

                            <div class="col-8 col-sm-7 col-md-7">
                                <div class="user-info">
                                    <span class="color">Hola</span>
                                    <img src="~/img/icon-user-male.jpg" class="avatar-header" width="50" height="50" alt="Avatar">
                                </div><!--.user-info-->
                            </div>
                        </div><!--.row-->
                    </div><!--.container-fluid-->
                </div>
                <section id="content">
                    <div class="content-wrap">
                        <div class="container-fluid px-lg-5">
                            <div class="row">
                                <div class="col-lg-8">
                                    <div hidden class="col-md-6 col-sm-12 col-xs-6 col-6">
                                        <h2>Ooops ha ocurrido un error</h2>
                                    </div>
                                    <div class="col-md-6 col-sm-12 col-xs-6 col-6">
                                        <h2>Ooops ha ocurrido un error :(</h2>
                                        <p>Accede nuevamente</p>
                                        <p><a id="urlLogn" href="">Login de usuario</a></p>
                                    </div>
                                    <div class="col-md-6 col-sm-12 col-xs-6 col-6">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
            <footer id="footer" style="bottom: 0; position: fixed;">
                <div class="container-fluid px-lg-5">
                    <div class="row">
                        <div class="col-6">
                            <p class="copyrights"><span class="color">DIAGNOSTIC 4U</span> 2020</p>
                        </div>
                        <div class="col-6">
                            <p class="text-support"><i class="far fa-life-ring"></i> SOPORTE</p>
                        </div>
                    </div>
                </div>
            </footer>
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">
            <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
            <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
            <script>
var redirect = "http://" + window.location.href.split('/')[2] + "/LoginAdmin/Login";
try {
var elem = document.getElementById("urlLogn").href = redirect;
} catch (e) {

}
swal("Tu sesión ha expirado, serás redireccionado al Login", "", "info").then(function () {
var elem = document.getElementById("urlLogn").click();
});
            </script>
        </body>
    }
}


</html>