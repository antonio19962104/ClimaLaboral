var IdPlanDeAccion = 0, IdAccionSeleccionada = 0; !function () { "use strict"; angular.module("app", []).controller("seguimientoController", function (e, n) { try { var a = this; function t(e) { var n; if (document.getElementById("loading").style.display = "none", "SessionTimeOut" == e.data) return swal("Tu sesión ha expirado", "", "info").then(function () { window.location.href = "/LoginAdmin/Login/" }), !1; switch (e.status) { case 200: return !1; case 400: alert("400 - Bad Request"), n = !0; break; case 401: alert("401 - Unauthorized"), n = !0; break; case 403: alert("403 - Forbidden"), n = !0; break; case 404: alert("404 - Not Found"), n = !0; break; case 408: alert("408 - Request TimeOut"), n = !0; break; case 500: alert("500 - Internal Server Error"), n = !0; break; case 502: alert("502 - Bad Gateway"), n = !0; break; case 503: alert("503 - Service Unavailable"), n = !0; break; default: alert("messageBoxError: " + e), n = !0 }return n } a.Modulo = "Consulta de Planes de Acción", a.ListPlanesDeAccion = [], a.ListAcciones = [], a.solIcono = "/img/ReporteoClima/Iconos/sol-icono.png", a.solNubeIcono = "/img/ReporteoClima/Iconos/solnube-icono.png", a.nubeIcono = "/img/ReporteoClima/Iconos/nube-icono.png", a.lluviaIcono = "/img/ReporteoClima/Iconos/lluvia-icono.png", 0 == a.ListAcciones.length ? a.Modulo = "Consulta de Planes de Acción" : a.Modulo = "Seguimiento de tu Plan de Acción", $(document).ready(function () { document.getElementById("loading").style.display = "block", $("#busqueda").on("keyup", function (e) { $("#mergePlan .alert-info").hide(); var n = e.target.value; if (n.length > 0) { var a = n.toUpperCase(), t = $("#mergePlan .alert-info");[].forEach.call(t, function (e) { var n = e.innerText; n = n.toUpperCase(); var t = !1; t = n.includes(a), "" != a && 1 == t && (e.style.display = "block") }) } else $("#mergePlan .alert-info").show() }), a.ObtenerPlanes() }), a.ObtenerPlanes = function () { a.get("/PlanesDeAccion/GetPlanes/?IdResponsable=" + IdResponsable, function (e) { e.Correct ? (0 == e.Objects.length && swal("No se encontraron planes de acción en donde te encuestres participando", "", "info"), a.ListPlanesDeAccion = e.Objects) : swal("Ocurrió un error al intentar obtener los planes de acción", e.ErrorMessage, "error"), document.getElementById("loading").style.display = "none" }) }, a.MostrarSeguimientoAcciones = function (e, n) { IdPlanDeAccion = n, document.getElementById("loading").style.display = "block", a.get("/PlanesDeAccion/GetAccionesByIdResponsable/?IdPlan=" + n + "&IdResponsable=" + IdResponsable, function (e) { e.Correct ? (a.Modulo = "Seguimiento de tu Plan de Acción", e.Objects[0].AccionesDeMejora.Descripcion = "Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.", a.ListAcciones = e.Objects, [].forEach.call([2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30], function (n) { a.ListAcciones.push(e.Objects[0]) })) : swal("Ocurrió un error al intentar obtener las acciones", e.ErrorMessage, "error"), document.getElementById("loading").style.display = "none" }) }, a.CerrarDetallePlan = function (e) { swal({ title: "¿Estás seguro de que deseas salir?", text: "", icon: "info", buttons: ["No", "Si"], dangerMode: !1, allowOutsideClick: !1, closeOnClickOutside: !1 }).then(function (e) { e && (document.getElementById("loading").style.display = "block", a.ListAcciones.length > 0 && (a.ListAcciones = [], a.Modulo = "Consulta de Planes de Acción", n.$apply()), document.getElementById("loading").style.display = "none") }) }, a.DetalleAccion = function (e) { a.Modulo = "Tarjeta de Acciones de Mejora", IdAccionSeleccionada = e, document.getElementById("mergePlan").children[0].style.display = "none"; var t = Enumerable.from(a.ListAcciones).where(n => n.AccionesDeMejora.IdAccionDeMejora == e).firstOrDefault(), o = templateDetalleAccion; o = a.replaceHtmlContent(o, t), $("#mergePlan").append(o), $(".delete-file").unbind(), [].forEach.call(document.getElementsByClassName("delete-file"), function (e) { e.addEventListener("click", function (e) { a.EliminarArchivo(e) }) }); var i = document.getElementById("listAcciones"), l = i.parentNode; l.insertBefore(i, l.firstChild), document.getElementsByClassName("btn-back-action-detalle")[0].addEventListener("click", function () { a.Modulo = "Seguimiento de tu Plan de Acción", n.$apply(), document.getElementById("listAcciones").remove(), document.getElementById("mergePlan").children[0].style.display = "" }), document.getElementsByClassName("btnGuardarDetalleAccion")[0].addEventListener("click", function () { a.AgregarArchivos() }) }, a.replaceHtmlContent = function (e, n) { var t = a.ObtenerRutaAtachment(n.Atachments); return e = (e = (e = (e = (e = (e = (e = (e = (e = (e = (e = (e = (e = (e = (e = e.replace("#competencia#", n.AccionesDeMejora.Categoria.Descripcion)).replace("#promedio#", n.AccionesDeMejora.Categoria.Promedio)).replace("#icono#", a.setIconoSVG(n.AccionesDeMejora.Categoria.Promedio))).replace("#accion#", n.AccionesDeMejora.Descripcion)).replace("#periodicidad#", n.Periodicidad)).replace("#inicio#", n.sFechaInicio)).replace("#fin#", n.sFechaFin)).replace("#objetivo#", n.Objetivo)).replace("#meta#", n.Meta)).replace("#name_responsable#", n.ListResponsable[0].Nombre)).replace("#email_responsable#", n.ListResponsable[0].Email)).replace("#comentarios#", n.Comentarios)).replace("#avance#", n.PorcentajeAvance)).replace("#cumplimiento#", "")).replace("#listAtachments#", t) }, a.ObtenerRutaAtachment = function (e) { var n = ""; return [].forEach.call(e, function (e) { var a = e.replace("\\\\\\\\10.5.2.101\\\\RHDiagnostics\\\\", "http://diagnostic4u.com/"); n += '<i class="fas fa-close delete-file" title="Eliminar archivo" style="cursor:pointer"></i><a href="' + a + '"><small style="display: block;">' + a + "</small></a>" }), 0 == n.length && (n = '<small style="display: block;color:red;">Aun no se suben evidencias</small>'), n }, a.setIconoSVG = function (e) { try { if ((e = parseFloat(e)) < 70) return a.lluviaIcono; if (e >= 70 && e < 80) return a.nubeIcono; if (e >= 80 && e < 90) return a.solNubeIcono; if (e >= 90 && e <= 100) return a.solIcono; e > 100 && swal("Existe un porcentaje mayor a 100, verificalo", "", "warning") } catch (e) { } }, a.PrintElem = function () { $(".tool-bar").hide(); var e = $("#printDiv").html(), n = window.open("", "new div", "height=1080,width=1920"); return n.document.write("<html><head><title></title>"), n.document.write('<link rel="stylesheet" href="http://diagnostic4u.com/css/custom-administrator.css" type="text/css" />'), n.document.write('<link rel="stylesheet" href="http://diagnostic4u.com/css/bootstrap.min.css" type="text/css" />'), n.document.write("<style>        .list-acciones span, small{display: block;}.errspan {float: right;margin - right: 15px;margin - top: -25px;position: relative;z-index: 2;}   </style></head><body >"), n.document.write(e), n.document.write("</body></html>"), n.document.close(), n.focus(), n.setTimeout(function () { n.print() }, 1e3), $(".tool-bar").show(), !0 }, a.Exportar = function () { $(".tool-bar").hide(); var e = new jspdf, n = document.getElementById("printDiv"); $("html,body").scrollTop(0), e.addHTML(n, 0, 0, { image: { type: "jpeg", quality: .98 }, html2canvas: { scale: 2, logging: !0 } }, function () { e.save(), $(".tool-bar").show() }) }, a.AgregarArchivos = function () { var e = new FormData, n = document.getElementById("fileChosser");[].forEach.call(n.files, function (n, a) { e.append(fileChosser + "_" + a, n) }), $.ajax({ url: "/PlanesDeAccion/AgregaArchivosSeguimieto/?IdPlan=" + IdPlanDeAccion + "&IdAccion=" + IdAccionSeleccionada, type: "POST", data: e, contentType: !1, processData: !1, success: function (e) { e.Correct ? swal("Las evidencias fueron agregadas con éxito", "", "success").then(function () { $("#listadoDocs").empty(); var n = "";[].forEach.call(e.Atachment, function (e) { var a = e.replace("\\\\\\\\10.5.2.101\\\\RHDiagnostics\\\\", "http://diagnostic4u.com/"); n += '<i class="fas fa-close delete-file" title="Eliminar archivo" style="cursor:pointer"></i><a href="' + a + '"><small style="display: block;">' + a + "</small></a>" }), $("#listadoDocs").append(n), $(".delete-file").unbind(), [].forEach.call(document.getElementsByClassName("delete-file"), function (e) { e.addEventListener("click", function (e) { a.EliminarArchivo(e) }) }) }) : swal("Ocurrió un error al intentar guardar las evidencias", e.ErrorMessage, "error") }, error: function (e) { swal("Ocurrió un error al intentar guardar las evidencias", e, "error") } }) }, a.EliminarArchivo = function (e) { var n = e.target.nextElementSibling.href; swal({ title: "¿Estás seguro de que deseas eliminar esta evidencia?", text: "", icon: "info", buttons: ["No", "Si"], dangerMode: !1, allowOutsideClick: !1, closeOnClickOutside: !1 }).then(function (t) { t && (document.getElementById("loading").style.display = "block", a.get("/PlanesDeAccion/EliminarEvidencia/?ruta=" + n, function (n) { document.getElementById("loading").style.display = "none", n.Correct ? swal("La evidencia se eliminó correctamente", "", "success").then(function () { e.target.nextElementSibling.remove(), e.target.remove() }) : swal("Ocurrió un error al intentar eliminar la evidencia", n.ErrorMessage, "error") })) }) }, a.getUid = function () { return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (e) { var n = 16 * Math.random() | 0, a = "x" == e ? n : 3 & n | 8; return a.toString(16) }) }, a.get = function (n, a, o) { e.get(n, { headers: { "Cache-Control": "no-cache" } }).then(function (e) { try { if (t(e)) return; a(e.data) } catch (e) { t(e) } }, function (e) { t(e) }).finally(function () { }) }, a.post = function (n, a, o, i) { e.post(n, a).then(function (e) { try { if (t(e)) return; o(e.data) } catch (e) { t(e) } }, function (e) { t(e) }).finally(function () { }) } } catch (e) { alert(e.message) } }) }(); var templateDetalleAccion = '\n<div class="sectionActions col" id="listAcciones">\n    <div id="cat_1" style="padding: 0px 0.5rem !important; display: block;">\n        <div class="title-header-blue">\n            <div class="row">\n                <div class="col-10">\n                    <span class="title-header-section"> #competencia#    #promedio#% <img class="ml-3" src="#icono#" style="width: 35px;height: auto;" /> </span>\n                </div>\n                <div class="col-2 text-center">\n                    <button title="Regresar" type="button" idcat="1" class="btn btn-secondary btn-action ml-1 btn-back-action-detalle"><i idcat="1" class="far fa-arrow-alt-circle-left"></i></button>\n                </div>\n            </div>\n        </div>\n        <div class="form-group">\n            <div id="accordion">\n                <div class="card">\n                    <div class="card-header" id="heading29_1">\n                        <h5 class="mb-0">\n                            <span class="btn btn-link col-12" data-toggle="collapse">\n                                <input type="text" disabled placeholder="Ingresa nombre de la acción" value="#accion#" class="form-control txt-Nom-Acc">\n                            </span>\n                        </h5>\n                    </div>\n\n                    <div id="collapse29_1" class="collapse show" aria-labelledby="heading29_1" data-parent="#accordion" style="">\n                        <div class="card-body">\n                            <div class="row form-group">\n                                <div class="col-3">Periodicidad: </div>\n                                <div class="col-5"><input type="text" disabled placeholder="Ingresa periocidad" value="#periodicidad#" class="form-control frm-periodicidad"></div>\n                                <div class="col-2"><i class="far fa-calendar-alt"></i>Inicia:<input disabled type="text" value="#inicio#" placeholder="Ingresa fecha de inicio" class="form-control frm-fecini"></div>\n                                <div class="col-2"><i class="far fa-calendar-alt"></i>Concluya:<input disabled type="text" value="#fin#" placeholder="Ingresa fecha de término" class="form-control frm-fecfin"></div>\n                            </div>\n                            <div class="row form-group">\n                                <div class="col-9">Objetivo: </div>\n                                <div class="col-3">Meta: </div>\n                            </div>\n                            <div class="row form-group">\n                                <div class="col-9"><input type="text" disabled value="#objetivo#" placeholder="Objetivo a alcanzar con la acción" class="form-control frm-objetivo"></div>\n                                <div class="col-3"><input type="text" disabled value="#meta#" placeholder="Ingresa meta" class="form-control frm-meta"></div>\n                            </div>\n                            <div class="row form-group">\n                                <div class="col-6">Responsable: </div>\n                                <div class="col-6">Email: </div>\n                            </div>\n                            <section class="reponsables_29  frm-responsables">\n                                <div class="row form-group">\n                                    <div class="col-6"><input type="text" disabled value="#name_responsable#" placeholder="Ingresa nombre del responsable" class="form-control frm-respon"></div>\n                                    <div class="col-6"><input type="text" disabled value="#email_responsable#" placeholder="Ingresa correo electrónico" class="form-control frm-respon-email"></div>\n                                </div>\n                            </section>\n                            <div class="row form-group">\n                                <div class="col-3">Comentarios: </div>\n                                <div class="col-9"><input type="text" disabled value="#comentarios#" placeholder="Ingresa comentarios" class="form-control frm-comentarios"></div>\n                            </div>\n\n                            <div class="row form-group col-6" style="float:left;">\n                                <div class="col-4">Adjuntar archivos de evidencia: </div>\n                                <div class="col-8"><input type="file" placeholder="Selecciona" class="form-control frm-archivos" id="fileChosser" name="fileChosser" multiple="multiple" /></div>\n                                <div id="listadoDocs" class="offset-4">\n                                    #listAtachments#\n                                </div>\n                            </div>\n\n                            <div class="row form-group col-6" style="">\n                                <div class="col -6">\n                                    <span style="display: block;">Avance: #avance#%</span>\n                                    <span style="display: block;">Cumplimiento de la acción: #cumplimiento#%</span>\n                                </div>\n                            </div>\n\n                            <div class="row form-group mt-4" style="float:right;">\n                                <input type="button" class="btn btn-info btnGuardarDetalleAccion" value="Guardar">\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n';